#!/usr/bin/perl
use strict;
use warnings;

my $keyPrefix="/apps/billboard";

sub main(@){
  my $config = {
    text => getText(),
    alignment => 'left',
  };

  for my $key(sort keys %$config){
    system "gconftool", "-s", "$keyPrefix/$key", "-t", "str", $$config{$key};
  }
}

sub getText(){
  my $G="{{green}}";
  my $R="{{red}}";

  my $sep = $G . "â€»";
  my $batPer = $R . "{battery}%";
  my $batCur = $R. "{script: chomp batcur}mA";
  my $date = $R . "{script:chomp date +%a}, {short-month} {day}";

  my $klomp="{script:klomp-info --format=\""
    . "$G%s%s %s %s\\n"
    . "$G%s\\n"
    . "$G%s %s"
    . "\""
    . " ended percent playlist album"
    . " artist"
    . " number title"
    . "}";

  return ''
    . "{script:chomp billboard-email}\n"
    . "{{green}}{volume-bar}\n"
    . $batPer . $sep . $batCur . $sep . $date . "\n"
    . $klomp . "\n"
    ;
}

&main(@ARGV);
